[build]
builder = "buildpacks"
buildpacks = ["nixpacks"]

[build.nixpacks.config]
pythonVersion = "3.11"
aptPackages = ["libpq-dev"]

[start]
cmd = "gunicorn app.main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120 --max-requests 1000 --max-requests-jitter 100"

[env]
PYTHONUNBUFFERED = "true"
PYTHONDONTWRITEBYTECODE = "true"
PIP_NO_CACHE_DIR = "true"
UV_COMPILE_BYTECODE = "true"
UV_HTTP_TIMEOUT = "600"

[variables]
PORT = "8000"
